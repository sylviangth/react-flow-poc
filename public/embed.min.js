(function () {
  // @ts-ignore
  var chatbotId = window.mindpalConfig.chatbotId;

  var div = document.createElement('div');
  var iframe = document.createElement('iframe');
  var button = document.createElement('button');
  var isIframeVisible = false;

  if (!chatbotId) {
    return;
  }

  iframe.src = `https://mindpal.space/chatbot/${chatbotId}`;
  iframe.style.width = '100%';
  iframe.style.height = '100%';
  iframe.style.border = '1px solid rgba(0, 0, 0, 0.15)';
  iframe.style.borderRadius = '20px';
  iframe.style.boxShadow = '0px 0px 10px rgba(0, 0, 0, 0.1)';
  iframe.style.display = 'none';

  button.innerHTML = '<img src=' + 'https://ph-files.imgix.net/9b89dafe-b565-431d-9093-23e626ae286a.png?auto=compress&codec=mozjpeg&cs=strip&auto=format&w=64&h=64&fit=crop&dpr=2' + '/>';
  button.style.marginTop = '10px';
  button.style.width = '56px';
  button.style.height = '56px';
  button.style.borderRadius = '100%';
  button.style.overflow = 'hidden';
  button.style.flexShrink = '0';
  button.style.boxShadow = '0px 0px 10px rgba(0, 0, 0, 0.4)';
  button.style.outline = '4px solid rgb(129, 140, 248, 1)';
  button.style.display = 'flex';
  button.style.alignItems = 'center';
  button.style.justifyContent = 'center';
  button.style.animationDuration = '300ms';
  button.style.backgroundColor = 'rgb(79, 70, 229, 1)';

  button.addEventListener('mouseenter', function () {
    button.style.outlineColor = 'rgb(165, 180, 252, 1)';
  });
  button.addEventListener('mouseleave', function () {
    button.style.outlineColor = 'rgb(129, 140, 248, 1)';
  });

  div.style.width = '64px';
  div.style.height = '64px';
  div.style.position = 'fixed';
  div.style.bottom = '24px';
  div.style.right = '24px';
  div.style.zIndex = '100';
  div.style.display = 'flex';
  div.style.flexDirection = 'column';
  div.style.alignItems = 'end';
  div.style.rowGap = '8px';
  div.style.justifyContent = 'end';

  button.addEventListener('click', function () {
    if (isIframeVisible) {
      div.style.width = '64px';
      div.style.height = '64px';
      iframe.style.display = 'none';
      button.innerHTML = '<img src=' + 'https://ph-files.imgix.net/9b89dafe-b565-431d-9093-23e626ae286a.png?auto=compress&codec=mozjpeg&cs=strip&auto=format&w=64&h=64&fit=crop&dpr=2' + '/>';
      isIframeVisible = false;
    } else {
      div.style.width = '400px';
      div.style.height = '90vh';
      iframe.style.display = 'block';
      button.innerHTML = `
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" style="width: 32px; height: 32px;" fill="white" class="bi bi-caret-down-fill" viewBox="0 0 16 16">
          <path d="M7.247 11.14 2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z"/>
        </svg>
      `
      isIframeVisible = true;
    }
  });

  div.appendChild(iframe);
  div.appendChild(button);
  document.body.appendChild(div);
})();